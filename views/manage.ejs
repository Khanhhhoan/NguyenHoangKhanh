<!-- add header -->
<%- include('includes/_header') %>
<!-- end header -->
<!-- Main section -->
<main id="main">
  <a href="/add-drug">
    <button id="new">New Drug <i class="fas fa-pills"></i></button>
  </a>

  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Drug Name</th>
        <th>Tablets per Card</th>
        <th>Tablets per Pack</th>
        <th>Taken per Day</th>
        <th>Daily dosage</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <!-- Loop through drugs -->
      <% for(let i = 0; i < drugs.length; i++) { %>
        <tr>
          <td><%= i + 1 %></td>
          <td><%= drugs[i].name %></td>
          <td><%= drugs[i].card %></td>
          <td><%= drugs[i].pack %></td>
          <td><%= drugs[i].perDay %></td>
          <td><%= drugs[i].dosage %></td>
          <td>
            <!-- Edit -->
            <a href="/update-drug?id=<%= drugs[i]._id %>">
              <span class='fa fa-edit'></span>
            </a>
            <!-- Delete -->
            <a href="#" class="delete" data-id="<%= drugs[i]._id %>">
              <span class='fa fa-trash'></span>
            </a>
          </td>
        </tr>
      <% } %>
    </tbody>
  </table>
</main>
<!-- End main section -->

<!-- JS delete handler -->
<script>
  document.querySelectorAll(".delete").forEach(btn => {
    btn.addEventListener("click", function(e) {
      e.preventDefault();
      const id = this.getAttribute("data-id");

      if (confirm("Do you really want to delete this drug?")) {
        fetch(`/api/drugs/${id}`, { method: "DELETE" })
          .then(res => res.json())
          .then(data => {
            alert(data.message);
            location.reload();
          })
          .catch(err => console.error(err));
      }
    });
  });
</script>

<!-- add footer -->
<%- include('includes/_footer') %>
<!-- end footer -->
